---
title: "Tworzenie modeli"
author: "Sandra Sobór, Anita Księżak"
date: "6 06 2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r wczytanie danych, warning = FALSE, message = FALSE}
library(dplyr)
library(forecast)
```

Poprzednie analizy pozwoliły nam zredukować dane oraz wysnuć wnioski o 
stacjonarnosci. Kolejnym i ostatnim krokiem będzie stworzenie modeli i dokonanie
predykcji. Wczytajmy zatem nasze szeregi czasowe oraz wektor odpowiadający za
różnicowanie szergów. 

```{r}
ts_dane <- readRDS("dane/szeregi.rds")
d <- readRDS("dane/wektor_d.rds")
testowy <- read.csv(paste0("dane/test.csv"))
```

Przejdźmy do stworzenia odpowieniego modelu oraz predykcji.

```{r}
nazwy <- names(ts_dane)
sklepy <- substr(nazwy, 1, 1)
produkty <- substr(nazwy, 3, 3)

p <- 5
q <- 1

nowa <- data.frame()
for (i in seq_along(ts_dane)) {
    a <- Arima(ts_dane[[i]], order = c(p, d[i], q))
    predykcja <- testowy %>%
        filter(store == sklepy[i],
               item == produkty[i])
    predykcja$sales <- forecast(a, h = nrow(predykcja))$mean %>%
        as.numeric()
    nowa <- bind_rows(nowa, predykcja)
}
```

Kolejnym krokiem jest uzupełnienie pliku testowego o predykowane wartości. Mając na uwadze pominięcie predykcji dla sklepów 
6(=5) ,9(=4) ,10(=3) uzupełnijmy plik testowy odpowiednimi wartościami.


```{r}
testowy <- mutate(testowy, sales = 0)


for (i in 1:nrow(testowy)) {
  for (j in 1:nrow(testowy)) {
    
    if (nowa$date[i] == testowy$date[j] &&
    nowa$store[i] == testowy$store[j] &&
    nowa$item[i] == testowy$item[j]) {
    testowy$sales[j]  <- nowa$sales[i]
    } else if (nowa$store[i] == 3 &&
    testowy$store[j] == 10 &&
    nowa$date[i] == testowy$date[j] &&
    nowa$item[i] == testowy$item[j]) {
    testowy$sales[j]  <- nowa$sales[i]
    } else if (nowa$store[i] == 4 &&
    testowy$store[j] == 9 &&
    nowa$date[i] == testowy$date[j] &&
    nowa$item[i] == testowy$item[j]) {
    testowy$sales[j]  <- nowa$sales[i]
    } else if (nowa$store[i] == 5 &&
    testowy$store[j] == 6 &&
    nowa$date[i] == testowy$date[j] &&
    nowa$item[i] == testowy$item[j]) {
    testowy$sales[j]  <- nowa$sales[i]
    }
    
  }
}
```
